{{define "content"}}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h1>Projects</h1>
        <a href="/projects/new" class="btn">New Project</a>
    </div>
    
    <div id="projects-list">
        <!-- Projects will be loaded here -->
    </div>
</div>

<script>
async function loadProjects() {
    try {
        const response = await fetch('/api/v1/projects');
        const projects = await response.json();
        const container = document.getElementById('projects-list');
        
        if (projects.length === 0) {
            container.innerHTML = '<p>No projects yet. <a href="/projects/new">Create your first project</a>!</p>';
            return;
        }
        
        container.innerHTML = projects.map(project => `
            <div class="list-item">
                <div>
                    <h3>${project.title}</h3>
                    <p>${project.description || 'No description'}</p>
                    <span class="status status-${project.status}">${project.status}</span>
                </div>
                <div class="list-actions">
                    <a href="/projects/${project.id}" class="btn btn-secondary">View</a>
                    <a href="/projects/${project.id}/edit" class="btn btn-secondary">Edit</a>
                    <button onclick="deleteProject(${project.id})" class="btn btn-danger">Delete</button>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Failed to load projects:', error);
        document.getElementById('projects-list').innerHTML = '<p>Failed to load projects. Please try again.</p>';
    }
}

async function deleteProject(id) {
    if (!confirm('Are you sure you want to delete this project?')) return;
    
    try {
        await fetch(`/api/v1/projects/${id}`, { method: 'DELETE' });
        loadProjects();
    } catch (error) {
        console.error('Failed to delete project:', error);
        alert('Failed to delete project. Please try again.');
    }
}

loadProjects();
</script>
{{end}}